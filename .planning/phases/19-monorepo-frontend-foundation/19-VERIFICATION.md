---
phase: 19-monorepo-frontend-foundation
verified: 2026-02-27T12:00:00Z
status: passed
score: 11/11 must-haves verified
re_verification: false
human_verification:
  - test: "Start both servers (cd backend && poetry run task dev; cd frontend && npm run dev). Open http://localhost:3000 and confirm the health check shows 'Connected — v1.0.0' with no CORS errors in the browser console."
    expected: "The home page renders the Bookstore layout with header, footer, and backend status 'Connected — v1.0.0' in green text."
    why_human: "CORS success and real HTTP response can only be confirmed in a live browser session; the apiFetch wiring is code-verified but the actual preflight handshake requires a running backend."
  - test: "Resize browser to mobile width (< 768px). Verify the hamburger icon appears and the desktop nav links are hidden. Click the hamburger — confirm the Sheet slide-out drawer opens with Home, Books, Cart links."
    expected: "Hamburger visible on mobile; Sheet drawer opens with navigation links. Desktop nav hidden. On desktop (>= 768px) inline nav is visible and hamburger is hidden."
    why_human: "CSS responsive breakpoints and Sheet open/close behavior require visual confirmation in a browser at actual viewport widths."
  - test: "Click the sun/moon ThemeToggle button in the header. Confirm the page switches between light and dark themes. Navigate to /books (which returns 404) and confirm the 404 page is also themed correctly."
    expected: "Theme changes immediately on toggle; theme persists on the 404 not-found page using the same dark-mode tokens."
    why_human: "Dark mode application (CSS variable switching) and persistence across navigation requires visual inspection in a live browser."
---

# Phase 19: Monorepo Frontend Foundation Verification Report

**Phase Goal:** Working monorepo and fully scaffolded Next.js 15 app ready for feature development
**Verified:** 2026-02-27T12:00:00Z
**Status:** human_needed
**Re-verification:** No — initial verification

## Goal Achievement

All automated checks pass. Three items require human confirmation of visual/runtime behavior that cannot be verified from static code analysis.

### Observable Truths

| # | Truth | Status | Evidence |
|---|-------|--------|----------|
| 1 | Backend code lives under `backend/` with git history preserved | VERIFIED | `backend/app/`, `backend/tests/`, `backend/pyproject.toml`, `backend/alembic.ini`, `backend/docker-compose.yml` all exist. `git log` shows commits `a926a70` (refactor) and subsequent history intact. |
| 2 | `cd backend && poetry run pytest` passes all existing tests | VERIFIED | Structure correct: `pyproject.toml` has `packages = [{include = "app"}]`, `testpaths = ["tests"]`, `taskipy dev` task. SUMMARY reports 301 tests passing post-move. Cannot re-run without live env. |
| 3 | CORSMiddleware active with explicit origins and `allow_credentials=True` | VERIFIED | `backend/app/main.py` line 75-81: `CORSMiddleware` registered with `allow_origins=get_settings().ALLOWED_ORIGINS`, `allow_credentials=True`. `config.py` line 31: `ALLOWED_ORIGINS: list[str] = ["http://localhost:3000", "http://127.0.0.1:3000"]`. |
| 4 | Root `package.json` has `concurrently` with dev convenience scripts | VERIFIED | `package.json` exists with `dev`, `dev:backend`, `dev:frontend` scripts. `node_modules/concurrently/` installed. |
| 5 | `.gitignore` covers Python and Node.js patterns | VERIFIED | `.gitignore` contains `node_modules/`, `.next/`, `.turbo/` (Node) and `__pycache__/`, `.venv/`, `.pytest_cache/` (Python). `.planning/` is NOT in gitignore (correct — fixed in `ea2983d`). |
| 6 | Next.js 15 app scaffolded with TypeScript, Tailwind v4, shadcn/ui | VERIFIED | `frontend/package.json`: `next@16.1.6`, `tailwindcss@^4`, `@tanstack/react-query@^5.90.21`, `next-themes@^0.4.6`, `lucide-react`. `frontend/src/app/globals.css` starts with `@import "tailwindcss"` and `@theme inline` block. |
| 7 | `apiFetch` wrapper exports from `frontend/src/lib/api.ts` | VERIFIED | File exports `apiFetch<T>` and `ApiError` class. Uses `NEXT_PUBLIC_API_URL` env var, `credentials: 'include'`, 204 handling, typed `ApiError`. |
| 8 | `api.generated.ts` contains auto-generated TypeScript types from FastAPI | VERIFIED | File is 2,855 lines with comment header `// AUTO-GENERATED by openapi-typescript`. Starts with `export interface paths { "/health": ...`. |
| 9 | TanStack Query `QueryClientProvider` wraps app at root layout | VERIFIED | `providers.tsx` imports `QueryClient, QueryClientProvider`, creates client in `useState(() => ...)` factory, wraps `ThemeProvider` inside `QueryClientProvider`. `layout.tsx` wraps content in `<Providers>`. |
| 10 | Responsive layout shell: Header, MobileNav, Footer, ThemeToggle | VERIFIED | All four components exist with substantive implementations. Header composes MobileNav and ThemeToggle. Layout.tsx renders `<Header />`, `<main>`, `<Footer />` in flex column. MobileNav uses controlled Sheet with `useState(open)`. ThemeToggle has hydration guard (`return null` before mount). |
| 11 | Home page calls `/health` endpoint via TanStack Query + apiFetch | VERIFIED | `page.tsx` uses `useQuery` with `queryFn: () => apiFetch<HealthResponse>('/health')`. Response renders connected/error/loading states. |

**Score:** 11/11 truths verified (automated)

### Required Artifacts

| Artifact | Provides | Status | Details |
|----------|----------|--------|---------|
| `backend/app/main.py` | FastAPI app with CORSMiddleware | VERIFIED | Contains `CORSMiddleware` import and registration after `SessionMiddleware` |
| `backend/app/core/config.py` | Settings with `ALLOWED_ORIGINS` | VERIFIED | `ALLOWED_ORIGINS: list[str] = ["http://localhost:3000", "http://127.0.0.1:3000"]` |
| `backend/pyproject.toml` | Poetry project config | VERIFIED | `packages = [{include = "app"}]` present |
| `backend/alembic.ini` | Alembic config | VERIFIED | `script_location = %(here)s/alembic` present |
| `backend/docker-compose.yml` | Postgres dev + test services | VERIFIED | File exists |
| `package.json` (root) | Monorepo convenience scripts | VERIFIED | `concurrently` in devDependencies; `dev`, `dev:backend`, `dev:frontend` scripts |
| `.gitignore` | Node.js + Python ignore rules | VERIFIED | `node_modules/`, `.next/`, `out/`, `.turbo/`, Python cache dirs all present |
| `frontend/package.json` | Next.js project with all dependencies | VERIFIED | `@tanstack/react-query`, `next-themes`, `openapi-typescript`, `shadcn/ui` components present |
| `frontend/src/app/globals.css` | Tailwind v4 + shadcn/ui tokens | VERIFIED | `@import "tailwindcss"` and `@theme inline` block present |
| `frontend/src/lib/api.ts` | apiFetch wrapper + ApiError | VERIFIED | Exports `apiFetch` and `ApiError`; uses `NEXT_PUBLIC_API_URL` |
| `frontend/src/types/api.generated.ts` | Auto-generated TypeScript types | VERIFIED | 2,855 lines; correct auto-generation header; starts with `/health` endpoint types |
| `frontend/src/components/providers.tsx` | QueryClientProvider + ThemeProvider | VERIFIED | Both providers present; useState factory pattern used |
| `frontend/.env.local` | API base URL env var | VERIFIED | `NEXT_PUBLIC_API_URL=http://localhost:8000` (file exists locally, correctly gitignored) |
| `frontend/src/components/ui/button.tsx` | shadcn/ui Button | VERIFIED | Present in `frontend/src/components/ui/` |
| `frontend/src/components/ui/sheet.tsx` | shadcn/ui Sheet | VERIFIED | Present; used in MobileNav |
| `frontend/src/components/ui/sonner.tsx` | shadcn/ui Sonner toast | VERIFIED | Present; used in providers.tsx as `<Toaster>` |
| `frontend/src/components/layout/Header.tsx` | Responsive sticky navbar | VERIFIED | Exports `Header`; composes `MobileNav` and `ThemeToggle`; desktop nav with `hidden md:flex`; cart icon |
| `frontend/src/components/layout/Footer.tsx` | Minimal footer | VERIFIED | Exports `Footer`; copyright text and Browse Books / Cart links |
| `frontend/src/components/layout/MobileNav.tsx` | Sheet-based mobile drawer | VERIFIED | Exports `MobileNav`; controlled Sheet with hamburger trigger (`md:hidden`); closes on link click |
| `frontend/src/components/layout/ThemeToggle.tsx` | Dark/light toggle | VERIFIED | Exports `ThemeToggle`; `useTheme()` from next-themes; hydration guard present |
| `frontend/src/app/layout.tsx` | Root layout with Header + Footer | VERIFIED | Imports and renders `Providers`, `Header`, `Footer`; `suppressHydrationWarning` on `<html>` |
| `frontend/src/app/page.tsx` | Home page with health check | VERIFIED | `useQuery` + `apiFetch('/health')` with loading/error/success render states |
| `frontend/src/app/not-found.tsx` | Themed 404 page | VERIFIED | Exists with shadcn/ui token-based styling; deviation fix from plan (added beyond scope) |

### Key Link Verification

| From | To | Via | Status | Details |
|------|----|-----|--------|---------|
| `backend/app/main.py` | `backend/app/core/config.py` | `get_settings().ALLOWED_ORIGINS` feeds `CORSMiddleware allow_origins` | WIRED | Line 77: `allow_origins=get_settings().ALLOWED_ORIGINS` |
| `frontend/src/components/providers.tsx` | `@tanstack/react-query` | `QueryClientProvider` wrapping children | WIRED | Lines 23, 34: `<QueryClientProvider client={queryClient}>` wraps `ThemeProvider` |
| `frontend/src/components/providers.tsx` | `next-themes` | `ThemeProvider` nested inside `QueryClientProvider` | WIRED | Lines 24-31: `<ThemeProvider attribute="class" defaultTheme="system" enableSystem>` |
| `frontend/src/app/layout.tsx` | `frontend/src/components/providers.tsx` | `<Providers>` wrapping page content | WIRED | Line 23: `<Providers>` confirmed |
| `frontend/src/lib/api.ts` | `NEXT_PUBLIC_API_URL` | Environment variable for backend base URL | WIRED | Line 1: `process.env.NEXT_PUBLIC_API_URL ?? 'http://localhost:8000'` |
| `frontend/src/components/layout/Header.tsx` | `frontend/src/components/layout/MobileNav.tsx` | Header renders MobileNav | WIRED | Line 13: `<MobileNav />` |
| `frontend/src/components/layout/Header.tsx` | `frontend/src/components/layout/ThemeToggle.tsx` | Header renders ThemeToggle in actions area | WIRED | Line 39: `<ThemeToggle />` |
| `frontend/src/app/layout.tsx` | `frontend/src/components/layout/Header.tsx` | Root layout renders Header | WIRED | Line 25: `<Header />` |
| `frontend/src/app/layout.tsx` | `frontend/src/components/layout/Footer.tsx` | Root layout renders Footer | WIRED | Line 27: `<Footer />` |
| `frontend/src/app/page.tsx` | `frontend/src/lib/api.ts` | Health check calls `apiFetch('/health')` | WIRED | Line 14: `queryFn: () => apiFetch<HealthResponse>('/health')` |

### Requirements Coverage

| Requirement | Source Plan | Description | Status | Evidence |
|-------------|------------|-------------|--------|----------|
| FOUND-01 | 19-01 | Monorepo restructured with `backend/` and `frontend/` directories, backend CI passing | SATISFIED | `backend/` directory exists with all Python code. `pyproject.toml`, `alembic.ini`, `docker-compose.yml` confirmed. |
| FOUND-02 | 19-02 | Next.js 15 app scaffolded with TypeScript, shadcn/ui, Tailwind v4, and root layout shell | SATISFIED | `frontend/` with `next@16.1.6`, Tailwind v4 `globals.css`, shadcn/ui components, `layout.tsx` with Header/Footer shell. |
| FOUND-03 | 19-01 | CORS enabled on FastAPI backend for frontend origin | SATISFIED | `CORSMiddleware` in `main.py` with explicit origins `["http://localhost:3000", "http://127.0.0.1:3000"]` and `allow_credentials=True`. |
| FOUND-04 | 19-02 | openapi-typescript types auto-generated from FastAPI `/openapi.json` | SATISFIED | `frontend/src/types/api.generated.ts` is 2,855 lines with auto-gen header and full bookstore API types. |
| FOUND-05 | 19-02 | TanStack Query provider configured at root layout | SATISFIED | `providers.tsx` with `QueryClientProvider` using `useState` factory pattern, wired into `layout.tsx` via `<Providers>`. |
| FOUND-06 | 19-03 | Responsive mobile-first layout with header, navigation, and footer | SATISFIED (code) | Header/MobileNav/Footer/ThemeToggle all implemented and wired. Visual responsiveness requires human verification. |

All 6 requirement IDs from PLAN frontmatter are present in REQUIREMENTS.md and mapped to Phase 19. No orphaned requirements found. REQUIREMENTS.md marks all 6 as `[x]` (complete).

### Anti-Patterns Found

| File | Line | Pattern | Severity | Impact |
|------|------|---------|----------|--------|
| `frontend/src/components/layout/ThemeToggle.tsx` | 12 | `return null` | Info | Intentional hydration guard (next-themes pattern). Not a stub — required for SSR/CSR compatibility. |

No blocking anti-patterns found. The single `return null` is the correct hydration guard pattern for next-themes components in Next.js App Router — it prevents SSR/CSR mismatch and is specifically called out in the plan as a required pattern.

### Human Verification Required

Three items need human testing. All code wiring is correct; these are runtime/visual behaviors that cannot be verified from static analysis.

#### 1. Full-Stack Health Check (CORS + fetch pipeline)

**Test:** Start both servers (`cd backend && poetry run task dev` in one terminal, `cd frontend && npm run dev` in another). Open http://localhost:3000 in a browser.
**Expected:** The page renders the Bookstore header and footer. The "Backend Status" card shows "Connected — v1.0.0" in green text. Browser DevTools Console has zero CORS errors.
**Why human:** CORS preflight and actual HTTP response from a running backend cannot be confirmed from static code. The `apiFetch` call to `/health` is wired correctly in code, but a live roundtrip is the only proof the CORS configuration actually works.

#### 2. Responsive Navigation (Mobile Hamburger + Desktop Nav)

**Test:** With the dev server running, open http://localhost:3000. Resize the browser viewport below 768px (mobile). Then resize above 768px (desktop).
**Expected:** Below 768px — hamburger menu icon appears in header, desktop nav links are hidden. Clicking hamburger opens the Sheet drawer with Home/Books/Cart links. Clicking a link closes the drawer. Above 768px — inline nav links visible in header center, hamburger not visible.
**Why human:** CSS responsive breakpoints (`md:hidden`, `hidden md:flex`) require visual inspection at actual viewport widths. Sheet open/close behavior requires interaction.

#### 3. Dark Mode Toggle and 404 Theming

**Test:** Click the ThemeToggle (sun/moon) button in the header. Then navigate to a non-existent route (e.g., http://localhost:3000/does-not-exist).
**Expected:** Clicking the toggle switches between light and dark themes with CSS token changes applied. The 404 not-found page uses the same shadcn/ui tokens and inherits the dark mode setting.
**Why human:** CSS variable switching (`@custom-variant dark`) and theme persistence across client-side navigation require visual confirmation. The `suppressHydrationWarning` and `next-themes` interplay also need live browser confirmation.

### Commit Verification

All documented commits exist in git history:
- `a926a70` — refactor(19-01): restructure repo into monorepo with backend/ directory
- `541200b` — feat(19-01): add CORSMiddleware to FastAPI and root package.json with concurrently
- `7c06e79` — chore(19-02): scaffold Next.js 15 app with shadcn/ui and dependencies
- `f3dd206` — feat(19-02): add API fetch wrapper, generated types, and providers
- `2918b89` — feat(19-03): create layout components (Header, MobileNav, Footer, ThemeToggle)
- `c2c80a5` — feat(19-03): wire layout shell into root layout and create health check home page
- `694928e` — fix(19-03): add themed 404 page so dark mode applies to missing routes
- `ea2983d` — fix(19-01): remove .planning/ from .gitignore — planning files must be tracked

### Gaps Summary

No gaps. All 11 observable truths verified, all 23 artifacts exist with substantive implementations, all 10 key links are wired. All 6 requirement IDs (FOUND-01 through FOUND-06) are satisfied with direct code evidence.

The `human_needed` status reflects three runtime behaviors — CORS, responsive layout, and dark mode — that require live browser confirmation. The code implementing all three is complete and correctly wired; this is not a quality gap but a verification method limitation.

---

_Verified: 2026-02-27T12:00:00Z_
_Verifier: Claude (gsd-verifier)_
