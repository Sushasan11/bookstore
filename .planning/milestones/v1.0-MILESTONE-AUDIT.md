---
milestone: v1.0
milestone_name: "Customer Storefront"
audited: 2026-02-27T20:00:00Z
status: tech_debt
scores:
  requirements: 29/29
  phases: 4/4
  integration: 26/28
  flows: 4/5
gaps:
  requirements: []
  integration:
    - from: "OrderDetail.tsx"
      to: "/orders (list page)"
      issue: "'View All Orders' CTA links to /orders which has no page.tsx — renders 404"
      affected_requirements: ["SHOP-06"]
      severity: "minor"
      note: "SHOP-07 (order history) is Phase 23 scope; the link is a premature forward reference"
    - from: "signOut() (NextAuth)"
      to: "POST /auth/logout (FastAPI)"
      issue: "Frontend signOut() clears session cookie but never calls backend /auth/logout — refresh token not server-invalidated"
      affected_requirements: ["AUTH-05"]
      severity: "minor"
      note: "User experience is correct (session cleared); security hygiene gap only — token expires naturally via TTL"
  flows:
    - flow: "View All Orders from confirmation"
      breaks_at: "OrderDetail 'View All Orders' link → /orders → 404"
      affected_requirements: ["SHOP-06"]
tech_debt:
  - phase: 19-monorepo-frontend-foundation
    items:
      - "FOUND-02, FOUND-04, FOUND-05 missing from SUMMARY frontmatter requirements_completed (code verified, documentation gap only)"
      - "3 human verification items: CORS roundtrip, responsive nav, dark mode toggle (code wired, needs live browser confirmation)"
  - phase: 20-auth-integration
    items:
      - "POST /auth/logout backend endpoint never called on signOut — refresh token not server-invalidated"
      - "AUTH-08 description says '401 handling' but backend sends 403 — documentation inconsistency"
      - "8 human verification items documented; 20-03 checkpoint approved by human"
  - phase: 21-catalog-and-search
    items:
      - "RatingDisplay.tsx TODO: Phase 25 — link to reviews section (intentional deferral)"
      - "3 human verification items: responsive grid, search debounce timing, JSON-LD in page source"
  - phase: 22-cart-and-checkout
    items:
      - "'View All Orders' CTA in OrderDetail links to non-existent /orders page (Phase 23 scope)"
---

# Milestone v1.0 "Customer Storefront" — Audit Report

**Audited:** 2026-02-27
**Status:** TECH DEBT (no blockers — all requirements satisfied)
**Score:** 29/29 requirements satisfied

## Phase Verification Summary

| Phase | VERIFICATION.md | Score | Status | Requirements Covered |
|-------|-----------------|-------|--------|---------------------|
| 19 Monorepo Frontend Foundation | Passed | 11/11 | human_needed (3 visual items) | FOUND-01 through FOUND-06 |
| 20 Auth Integration | Passed | 11/11 | human_needed (8 live browser items; 20-03 approved) | AUTH-01 through AUTH-08 |
| 21 Catalog and Search | Passed | 13/13 | PASSED | CATL-01 through CATL-07 |
| 22 Cart and Checkout | Passed | 17/17 | PASSED | SHOP-01–06, SHOP-09, SHOP-10 |

All 4 phases have VERIFICATION.md files. No unverified phases.

## Requirements Coverage (3-Source Cross-Reference)

### Source Summary

| Source | Coverage | Notes |
|--------|----------|-------|
| VERIFICATION.md status | 29/29 SATISFIED | All 4 phases report all requirements satisfied |
| REQUIREMENTS.md checkboxes | 29/29 `[x]` | All milestone requirements checked off |
| SUMMARY frontmatter | 26/29 listed | FOUND-02, FOUND-04, FOUND-05 missing from Phase 19 summaries |

### Detailed Cross-Reference

#### Foundation (Phase 19) — 6/6

| REQ-ID | Description | VERIFICATION | SUMMARY | REQ Checkbox | Final Status |
|--------|-------------|-------------|---------|--------------|--------------|
| FOUND-01 | Monorepo restructured | passed | listed (19-01) | [x] | **satisfied** |
| FOUND-02 | Next.js 15 scaffolded | passed | missing | [x] | **satisfied** (doc gap) |
| FOUND-03 | CORS enabled | passed | listed (19-01) | [x] | **satisfied** |
| FOUND-04 | openapi-typescript types | passed | missing | [x] | **satisfied** (doc gap) |
| FOUND-05 | TanStack Query configured | passed | missing | [x] | **satisfied** (doc gap) |
| FOUND-06 | Responsive layout shell | passed | listed (19-03) | [x] | **satisfied** |

Note: FOUND-02, FOUND-04, FOUND-05 are verified in 19-VERIFICATION.md with concrete evidence (code exists, artifacts confirmed). The SUMMARY frontmatter gap is a metadata omission — plan 19-02 completed these but did not list them in `requirements_completed`.

#### Auth (Phase 20) — 8/8

| REQ-ID | Description | VERIFICATION | SUMMARY | REQ Checkbox | Final Status |
|--------|-------------|-------------|---------|--------------|--------------|
| AUTH-01 | Sign up with email/password | passed | listed (20-01, 20-03) | [x] | **satisfied** |
| AUTH-02 | Log in with email/password | passed | listed (20-01, 20-03) | [x] | **satisfied** |
| AUTH-03 | Google OAuth | passed | listed (20-01, 20-03) | [x] | **satisfied** |
| AUTH-04 | Session persistence | passed | listed (20-01, 20-03) | [x] | **satisfied** |
| AUTH-05 | Logout | passed | listed (20-02, 20-03) | [x] | **satisfied** |
| AUTH-06 | Route protection | passed | listed (20-02, 20-03) | [x] | **satisfied** |
| AUTH-07 | Token refresh | passed | listed (20-01, 20-03) | [x] | **satisfied** |
| AUTH-08 | Deactivated user signout | passed | listed (20-02, 20-03) | [x] | **satisfied** |

#### Catalog (Phase 21) — 7/7

| REQ-ID | Description | VERIFICATION | SUMMARY | REQ Checkbox | Final Status |
|--------|-------------|-------------|---------|--------------|--------------|
| CATL-01 | Paginated book grid | passed | listed (21-02, 21-04) | [x] | **satisfied** |
| CATL-02 | Book detail page | passed | listed (21-03, 21-04) | [x] | **satisfied** |
| CATL-03 | Full-text search | passed | listed (21-02, 21-04) | [x] | **satisfied** |
| CATL-04 | Genre and price filter | passed | listed (21-02, 21-04) | [x] | **satisfied** |
| CATL-05 | URL state persistence | passed | listed (21-02, 21-04) | [x] | **satisfied** |
| CATL-06 | SEO metadata (JSON-LD, OG) | passed | listed (21-03, 21-04) | [x] | **satisfied** |
| CATL-07 | Server-rendered with ISR | passed | listed (21-02, 21-03, 21-04) | [x] | **satisfied** |

#### Shopping (Phase 22) — 8/8

| REQ-ID | Description | VERIFICATION | SUMMARY | REQ Checkbox | Final Status |
|--------|-------------|-------------|---------|--------------|--------------|
| SHOP-01 | Add to cart | passed | listed (22-05) | [x] | **satisfied** |
| SHOP-02 | Update cart quantity | passed | listed (22-03, 22-05) | [x] | **satisfied** |
| SHOP-03 | Remove cart item | passed | listed (22-03, 22-05) | [x] | **satisfied** |
| SHOP-04 | View cart with totals | passed | listed (22-03, 22-05) | [x] | **satisfied** |
| SHOP-05 | Checkout and place order | passed | listed (22-05) | [x] | **satisfied** |
| SHOP-06 | Order confirmation page | passed | listed (22-05) | [x] | **satisfied** |
| SHOP-09 | Cart badge in navbar | passed | listed (22-05) | [x] | **satisfied** |
| SHOP-10 | Optimistic cart updates | passed | listed (22-03, 22-05) | [x] | **satisfied** |

### Orphan Detection

No orphaned requirements. All 29 REQ-IDs assigned to Phases 19-22 in the traceability table appear in at least one phase VERIFICATION.md and are marked SATISFIED.

## Cross-Phase Integration

### Export Chain Verification

| From Phase | Export | Consumed By | Status |
|-----------|--------|-------------|--------|
| 19 | `apiFetch` / `ApiError` (`lib/api.ts`) | Phase 20 (`auth.ts`), Phase 21 (`catalog.ts`), Phase 22 (`cart.ts`) | WIRED |
| 19 | `api.generated.ts` types | Phase 21 (`catalog.ts`), Phase 22 (`cart.ts`, `CartItem`, `OrderDetail`) | WIRED |
| 19 | `Providers` wrapper | Phase 20 added `SessionProvider`; wraps entire app via `layout.tsx` | WIRED |
| 19 | `Header` / `Footer` / `MobileNav` | All pages via `layout.tsx`; Phase 20 added `UserMenu`, Phase 22 added `CartBadge` | WIRED |
| 19 | `QueryClientProvider` | Phase 22 `useCart` hook uses `useQuery`/`useMutation`; Phase 21 home page `useQuery` | WIRED |
| 20 | `auth.ts` (signIn/signOut/auth) | `LoginForm`, `RegisterForm`, `GoogleSignInButton`, `UserMenu`, `proxy.ts`, `providers.tsx`, `orders/[id]/page.tsx` | WIRED |
| 20 | `SessionProvider` + `useSession` | Phase 22 `cart.ts` reads `session.accessToken` for all API calls | WIRED |
| 20 | `proxy.ts` route protection | `/cart` added by Phase 22; `/orders` prefix covers Phase 22 order pages | WIRED |
| 20 | 403 interceptor (`providers.tsx`) | Phase 22 cart mutations throw `ApiError` which triggers signout on 403 | WIRED |
| 21 | `catalog.ts` fetch helpers | Phase 21 pages; Phase 22 `ActionButtons` references book data from parent | WIRED |
| 21 | `BookCard` component | Phase 22 upgraded to `'use client'` with cart icon; reused in `NoResults`, `MoreInGenre` | WIRED |
| 21 | `ActionButtons` component | Phase 22 upgraded from disabled placeholders to functional `useCart().addItem` | WIRED |

**Connected:** 26 cross-phase exports verified
**Orphaned:** 0

### Integration Issues

| # | Issue | Severity | Affected REQ |
|---|-------|----------|-------------|
| 1 | `OrderDetail.tsx` "View All Orders" CTA links to `/orders` — no `page.tsx` exists (404) | Minor | SHOP-06 |
| 2 | `signOut()` never calls `POST /auth/logout` — refresh token not server-invalidated | Minor | AUTH-05 |

**Issue 1 context:** SHOP-07 (order history list) is Phase 23 scope. The "View All Orders" link is a premature forward reference — the button renders but leads to 404. The order confirmation page itself (SHOP-06) functions correctly.

**Issue 2 context:** NextAuth `signOut()` clears the session cookie, which is the user-visible logout behavior. The backend `/auth/logout` endpoint would revoke the refresh token server-side, but since the access token has a 15-min TTL and the refresh token eventually expires, the practical security impact is minimal.

### Orphaned Backend Routes

| Route | Reason |
|-------|--------|
| `POST /auth/logout` | Frontend never calls it; signOut() is client-only |
| `GET /auth/google` + `/auth/google/callback` | Superseded by `POST /auth/google/token` (per 20-01 design decision) |

## E2E Flow Verification

| # | Flow | Steps | Status | Notes |
|---|------|-------|--------|-------|
| 1 | Anonymous Browsing | Visit /catalog → search → filter → sort → paginate → book detail | COMPLETE | All CATL requirements exercised |
| 2 | Cart-to-Checkout | Login → browse → add to cart → view cart → update qty → checkout → confirmation | COMPLETE | All SHOP requirements exercised |
| 3 | Session Lifecycle | Login → refresh → page reload → token expiry → transparent refresh → signout | COMPLETE | AUTH-04, AUTH-07 verified |
| 4 | Google OAuth | GoogleSignInButton → consent → /auth/google/token → session established | COMPLETE | Requires env vars configured |
| 5 | Order History from Confirmation | Checkout → confirmation → "View All Orders" → /orders | BROKEN at last step | /orders page.tsx missing (Phase 23) |

## Tech Debt Summary

### Phase 19: Monorepo Frontend Foundation
- FOUND-02, FOUND-04, FOUND-05 not listed in SUMMARY `requirements_completed` frontmatter (code verified — documentation gap)
- 3 items need human browser verification: CORS roundtrip, responsive navigation, dark mode toggle

### Phase 20: Auth Integration
- `POST /auth/logout` backend endpoint not called on signOut — refresh token not server-invalidated
- AUTH-08 REQUIREMENTS.md description says "401 handling" but backend sends 403 — doc inconsistency
- 8 items flagged for human verification (20-03 checkpoint approved by human 2026-02-27)

### Phase 21: Catalog and Search
- `RatingDisplay.tsx` TODO: Phase 25 link to reviews section (intentional deferral)
- 3 items need human browser verification: responsive grid layout, search debounce timing, JSON-LD in page source

### Phase 22: Cart and Checkout
- "View All Orders" CTA in OrderDetail links to non-existent /orders page (Phase 23 scope — premature forward reference)

**Total: 10 tech debt items across 4 phases (0 blockers)**

## Conclusion

All 29 requirements assigned to milestone phases 19-22 are **satisfied** with code evidence. No critical gaps or blockers found. The milestone is functionally complete with 10 accumulated tech debt items — mostly documentation gaps and premature forward references to Phase 23+ features. The 2 integration issues (dead "View All Orders" link, backend logout not called) are minor and non-blocking.

---
*Audited: 2026-02-27T20:00:00Z*
*Auditor: Claude (gsd milestone audit)*
