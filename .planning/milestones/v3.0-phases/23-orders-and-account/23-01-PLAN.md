---
phase: 23-orders-and-account
plan: "01"
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/lib/orders.ts
  - frontend/src/app/orders/page.tsx
  - frontend/src/app/orders/loading.tsx
  - frontend/src/app/orders/_components/OrderHistoryList.tsx
  - frontend/src/app/account/page.tsx
  - frontend/src/components/layout/Header.tsx
  - frontend/src/components/layout/MobileNav.tsx
autonomous: true
requirements: [SHOP-07, SHOP-08]

must_haves:
  truths:
    - "User can view a paginated list of their past orders showing date, total, and item summary"
    - "User can click an order in the list to navigate to /orders/[id] and see full item details with price snapshots"
    - "User can access an account hub page at /account with a link to order history"
    - "Account link is visible in both desktop nav and mobile nav"
  artifacts:
    - path: "frontend/src/lib/orders.ts"
      provides: "fetchOrders() server-side API helper"
      exports: ["fetchOrders"]
    - path: "frontend/src/app/orders/page.tsx"
      provides: "Order history list page (server component)"
      contains: "fetchOrders"
    - path: "frontend/src/app/orders/loading.tsx"
      provides: "Loading skeleton for order history page"
      contains: "Skeleton"
    - path: "frontend/src/app/orders/_components/OrderHistoryList.tsx"
      provides: "Client component with paginated order rows"
      contains: "useState"
    - path: "frontend/src/app/account/page.tsx"
      provides: "Account hub page with nav cards"
      contains: "Order History"
    - path: "frontend/src/components/layout/Header.tsx"
      provides: "Account link in desktop nav"
      contains: "/account"
    - path: "frontend/src/components/layout/MobileNav.tsx"
      provides: "Account link in mobile nav"
      contains: "/account"
  key_links:
    - from: "frontend/src/app/orders/page.tsx"
      to: "frontend/src/lib/orders.ts"
      via: "import fetchOrders"
      pattern: "fetchOrders\\(session\\.accessToken\\)"
    - from: "frontend/src/app/orders/_components/OrderHistoryList.tsx"
      to: "frontend/src/app/orders/[id]/page.tsx"
      via: "Link href /orders/{id}"
      pattern: "href=.*orders/"
    - from: "frontend/src/app/account/page.tsx"
      to: "frontend/src/app/orders/page.tsx"
      via: "Link href /orders"
      pattern: "href=.*/orders"
---

<objective>
Build the order history list page, account hub page, and navigation wiring for Phase 23.

Purpose: Users need to view their past orders (SHOP-07) and navigate to individual order details (SHOP-08). The /orders/[id] detail page already exists from Phase 22 — this plan creates the /orders index page that links to it, plus an /account hub page for centralized account navigation.

Output: 7 files — fetchOrders helper, /orders list page with loading skeleton and paginated client component, /account hub page, Header and MobileNav with Account link.
</objective>

<execution_context>
@C:/Users/Sushasan/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Sushasan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/23-orders-and-account/23-RESEARCH.md

Key existing files:
@frontend/src/lib/api.ts
@frontend/src/lib/cart.ts
@frontend/src/app/orders/[id]/page.tsx
@frontend/src/app/orders/[id]/_components/OrderDetail.tsx
@frontend/src/components/layout/Header.tsx
@frontend/src/components/layout/MobileNav.tsx
@frontend/src/app/cart/loading.tsx

<interfaces>
<!-- Key types and contracts the executor needs. Extracted from codebase. -->
<!-- Executor should use these directly — no codebase exploration needed. -->

From frontend/src/lib/api.ts:
```typescript
export class ApiError extends Error {
  constructor(message: string, public status: number, public detail?: string, public data?: unknown) { ... }
}
export async function apiFetch<T>(path: string, options?: RequestInit): Promise<T>
```

From frontend/src/lib/cart.ts (relevant exports):
```typescript
type OrderResponse = components['schemas']['OrderResponse']
export type { OrderResponse }
export async function fetchOrder(accessToken: string, orderId: number): Promise<OrderResponse>
```

From frontend/src/auth.ts (relevant export):
```typescript
export const { handlers, auth, signIn, signOut } = NextAuth({ ... })
// auth() returns session with session.accessToken (string) and session.user.email
```

From frontend/src/app/orders/[id]/page.tsx (server component pattern):
```typescript
import { auth } from '@/auth'
import { redirect } from 'next/navigation'
import { fetchOrder } from '@/lib/cart'
// Pattern: const session = await auth(); if (!session?.accessToken) redirect('/login')
```

OrderResponse shape (from api.generated.ts):
```typescript
// OrderResponse has: id (number), status (string), total_price (string), created_at (string), items (OrderItemResponse[])
// OrderItemResponse has: id (number), book_id (number), quantity (number), unit_price (string), book (OrderItemBookSummary | null)
// OrderItemBookSummary has: title (string), author (string)
```

From frontend/src/components/layout/Header.tsx:
```typescript
// Desktop nav section: <nav className="hidden md:flex items-center gap-6">
//   <Link href="/catalog" className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors">Books</Link>
// </nav>
```

From frontend/src/components/layout/MobileNav.tsx:
```typescript
const navLinks = [
  { href: '/', label: 'Home' },
  { href: '/catalog', label: 'Books' },
  { href: '/cart', label: 'Cart' },
]
```
</interfaces>
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create fetchOrders helper, /orders list page with loading skeleton and paginated OrderHistoryList</name>
  <files>
    frontend/src/lib/orders.ts
    frontend/src/app/orders/page.tsx
    frontend/src/app/orders/loading.tsx
    frontend/src/app/orders/_components/OrderHistoryList.tsx
  </files>
  <action>
Create four files for the order history feature:

**1. `frontend/src/lib/orders.ts`** — Server-side fetch helper for order list.
```typescript
import { apiFetch } from '@/lib/api'
import type { components } from '@/types/api.generated'

type OrderResponse = components['schemas']['OrderResponse']

export async function fetchOrders(accessToken: string): Promise<OrderResponse[]> {
  return apiFetch<OrderResponse[]>('/orders', {
    headers: { Authorization: `Bearer ${accessToken}` },
  })
}
```
NOTE: Do NOT add `'use client'` — this is a server-only module. Do NOT move `fetchOrder` (singular) out of `cart.ts` — keep it there to avoid breaking the existing `/orders/[id]/page.tsx` import.

**2. `frontend/src/app/orders/page.tsx`** — Server component for order history list.
Follow the exact pattern of `/orders/[id]/page.tsx`:
- Import `auth` from `@/auth`, `redirect` from `next/navigation`
- Import `fetchOrders` from `@/lib/orders`
- Import `OrderHistoryList` from `./_components/OrderHistoryList`
- Export `metadata = { title: 'Order History' }`
- `auth()` guard: if no `session?.accessToken`, redirect to `/login`
- Call `fetchOrders(session.accessToken)` to get the orders array
- Render a container `<div className="mx-auto max-w-3xl px-4 py-8">` with:
  - `<h1 className="text-2xl font-bold mb-6">Order History</h1>`
  - `<OrderHistoryList orders={orders} />`

**3. `frontend/src/app/orders/loading.tsx`** — Loading skeleton.
Follow the pattern of `frontend/src/app/cart/loading.tsx`:
- Import `Skeleton` from `@/components/ui/skeleton`
- Same max-w-3xl container as the page
- Skeleton for the h1 (`h-8 w-48 mb-6`)
- 3 skeleton order rows: each in a `rounded-lg border p-4` div, with flex justify-between containing:
  - Left side: 3 Skeleton lines (h-5 w-24 for order #, h-4 w-40 for date, h-4 w-56 for items)
  - Right side: Skeleton for price (h-5 w-16)

**4. `frontend/src/app/orders/_components/OrderHistoryList.tsx`** — Client component with client-side pagination.
- `'use client'` directive
- Import `useState` from `react`, `Link` from `next/link`, `Button` from `@/components/ui/button`
- Import `type { components }` from `@/types/api.generated`
- `type OrderResponse = components['schemas']['OrderResponse']`
- `const PAGE_SIZE = 10`
- Props: `{ orders: OrderResponse[] }`
- Empty state: if `orders.length === 0`, render centered text "No orders yet." with a "Browse Books" button linking to `/catalog`
- Pagination state: `const [page, setPage] = useState(1)`
- Compute `totalPages = Math.ceil(orders.length / PAGE_SIZE)` and `pageOrders = orders.slice((page - 1) * PAGE_SIZE, page * PAGE_SIZE)`
- For each order, render a `Link` to `/orders/${order.id}` styled as a clickable card:
  - `className="block rounded-lg border p-4 hover:bg-accent transition-colors"`
  - Flex row: left side has order #, date (toLocaleDateString with year/month/day options), item summary line; right side has total_price
  - Item summary: show `order.items.length` item count, then first item title (`order.items[0]?.book?.title ?? 'Deleted Book'`), then `+N more` if multiple items
  - Use `${order.total_price}` directly (string type, consistent with OrderDetail)
- Pagination controls: only render if `totalPages > 1`. Previous/Next Buttons (variant="outline" size="sm") with disabled states and `Page X of Y` text between them
  </action>
  <verify>
    <automated>cd frontend && npx tsc --noEmit && npm run build 2>&1 | tail -20</automated>
  </verify>
  <done>
    - /orders page renders a server-fetched list of orders with date, total, and item summary
    - Each order row links to /orders/{id} for full detail view
    - Loading skeleton displays while server fetches orders
    - Empty state shows "No orders yet" with Browse Books link
    - Client-side pagination with 10 items per page and Previous/Next controls
  </done>
</task>

<task type="auto">
  <name>Task 2: Create /account hub page and wire Account link into Header and MobileNav</name>
  <files>
    frontend/src/app/account/page.tsx
    frontend/src/components/layout/Header.tsx
    frontend/src/components/layout/MobileNav.tsx
  </files>
  <action>
Create the account hub page and add navigation links:

**1. `frontend/src/app/account/page.tsx`** — Server component account hub.
- Import `auth` from `@/auth`, `redirect` from `next/navigation`
- Import `Link` from `next/link`
- Import `Card` from `@/components/ui/card`
- Import `Package` from `lucide-react` (icon for orders)
- Export `metadata = { title: 'My Account' }`
- `auth()` guard: if no `session?.accessToken`, redirect to `/login`
- Extract `email = session.user?.email ?? ''`
- Render container `<div className="mx-auto max-w-3xl px-4 py-8">`:
  - `<h1 className="text-2xl font-bold mb-2">My Account</h1>`
  - `<p className="text-muted-foreground mb-8">{email}</p>`
  - Grid of nav cards `<div className="grid gap-4 sm:grid-cols-2">`:
    - Order History card: `Link href="/orders"` wrapping a `Card` with `className="p-6 hover:bg-accent transition-colors cursor-pointer"` containing:
      - `<Package className="h-6 w-6 mb-3 text-muted-foreground" />`
      - `<h2 className="font-semibold">Order History</h2>`
      - `<p className="text-sm text-muted-foreground mt-1">View your past orders</p>`
    - Add a comment `{/* Wishlist and Pre-bookings — Phase 24 */}` as placeholder for future cards

**2. `frontend/src/components/layout/Header.tsx`** — Add Account link to desktop nav.
In the `<nav className="hidden md:flex items-center gap-6">` section, add AFTER the existing "Books" link:
```tsx
<Link
  href="/account"
  className="text-sm font-medium text-muted-foreground hover:text-foreground transition-colors"
>
  Account
</Link>
```

**3. `frontend/src/components/layout/MobileNav.tsx`** — Add Account to navLinks array.
Add `{ href: '/account', label: 'Account' }` to the end of the `navLinks` array (after the Cart entry).
  </action>
  <verify>
    <automated>cd frontend && npx tsc --noEmit && npm run build 2>&1 | tail -20</automated>
  </verify>
  <done>
    - /account page shows user email and Order History nav card linking to /orders
    - Desktop nav (Header) shows "Account" link alongside "Books"
    - Mobile nav (MobileNav) shows "Account" in the nav drawer
    - Account page is protected by auth() guard — unauthenticated users redirect to /login
  </done>
</task>

</tasks>

<verification>
1. `cd frontend && npx tsc --noEmit` — no TypeScript errors
2. `cd frontend && npm run build` — build succeeds with /orders and /account listed as routes
3. /orders page fetches orders server-side and renders OrderHistoryList with clickable rows linking to /orders/{id}
4. /orders/loading.tsx shows skeleton while fetching
5. /account page shows email and Order History card linking to /orders
6. Header desktop nav includes Account link; MobileNav drawer includes Account link
7. Both /orders and /account redirect to /login if not authenticated (proxy.ts already has both prefixes)
</verification>

<success_criteria>
- SHOP-07: Order history page at /orders showing date, total price, and item summary for each order, with pagination controls
- SHOP-08: Each order row links to /orders/{id} where OrderDetail (from Phase 22) renders the full item list with unit prices
- Account hub at /account provides central navigation to order history
- Account link discoverable in both desktop and mobile navigation
- Build passes with no TypeScript errors
</success_criteria>

<output>
After completion, create `.planning/phases/23-orders-and-account/23-01-SUMMARY.md`
</output>
