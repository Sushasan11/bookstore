---
phase: 19-monorepo-frontend-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 19-01
files_modified:
  - frontend/package.json
  - frontend/src/app/globals.css
  - frontend/src/app/layout.tsx
  - frontend/src/app/page.tsx
  - frontend/next.config.ts
  - frontend/tsconfig.json
  - frontend/.env.local
  - frontend/src/lib/api.ts
  - frontend/src/types/api.generated.ts
  - frontend/src/components/providers.tsx
autonomous: true
requirements:
  - FOUND-02
  - FOUND-04
  - FOUND-05

must_haves:
  truths:
    - "Running `cd frontend && npm run dev` starts a Next.js 15 dev server on port 3000"
    - "The app renders in the browser with Tailwind CSS styles applied (not unstyled HTML)"
    - "shadcn/ui components (Button, Sheet, Toaster) are available in `frontend/src/components/ui/`"
    - "`frontend/src/types/api.generated.ts` exists and contains TypeScript types matching the FastAPI schema"
    - "TanStack Query QueryClientProvider wraps the application at the root layout level"
    - "Dark mode toggle switches between light and dark themes using next-themes"
  artifacts:
    - path: "frontend/package.json"
      provides: "Next.js project with all required dependencies"
      contains: "@tanstack/react-query"
    - path: "frontend/src/app/globals.css"
      provides: "Tailwind v4 CSS-first config with shadcn/ui tokens"
      contains: '@import "tailwindcss"'
    - path: "frontend/src/lib/api.ts"
      provides: "Thin fetch wrapper with base URL, auth headers, JSON parsing"
      exports: ["apiFetch"]
    - path: "frontend/src/types/api.generated.ts"
      provides: "Auto-generated TypeScript types from FastAPI OpenAPI spec"
    - path: "frontend/src/components/providers.tsx"
      provides: "Client-side Providers component with QueryClientProvider + ThemeProvider"
      contains: "QueryClientProvider"
    - path: "frontend/.env.local"
      provides: "Environment variable for API base URL"
      contains: "NEXT_PUBLIC_API_URL"
  key_links:
    - from: "frontend/src/components/providers.tsx"
      to: "@tanstack/react-query"
      via: "QueryClientProvider wrapping children"
      pattern: "QueryClientProvider"
    - from: "frontend/src/components/providers.tsx"
      to: "next-themes"
      via: "ThemeProvider nested inside QueryClientProvider"
      pattern: "ThemeProvider"
    - from: "frontend/src/app/layout.tsx"
      to: "frontend/src/components/providers.tsx"
      via: "Providers component wrapping page content"
      pattern: "<Providers>"
    - from: "frontend/src/lib/api.ts"
      to: "NEXT_PUBLIC_API_URL"
      via: "Environment variable for backend base URL"
      pattern: "NEXT_PUBLIC_API_URL"
---

<objective>
Scaffold the Next.js 15 frontend with TypeScript, Tailwind v4, shadcn/ui, dark mode support, TanStack Query provider, and auto-generated API types from FastAPI's OpenAPI spec. Create the thin fetch wrapper that all future API calls will use.

Purpose: Establishes the complete frontend foundation — every subsequent frontend phase builds on this scaffold, these providers, and this API client pattern.
Output: Working Next.js 15 app at `frontend/` with shadcn/ui components, TanStack Query configured, API types generated, and fetch wrapper ready.
</objective>

<execution_context>
@C:/Users/Sushasan/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Sushasan/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/19-monorepo-frontend-foundation/19-RESEARCH.md
@.planning/phases/19-monorepo-frontend-foundation/19-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Scaffold Next.js 15 app with shadcn/ui and install all dependencies</name>
  <files>
    frontend/package.json
    frontend/src/app/globals.css
    frontend/next.config.ts
    frontend/tsconfig.json
  </files>
  <action>
From the repo root, scaffold the Next.js 15 app with TypeScript and Tailwind defaults:

```bash
npx create-next-app@latest frontend --yes
```

The `--yes` flag accepts all defaults: TypeScript, Tailwind CSS v4, App Router, `src/` directory, Turbopack. This creates `frontend/` with a working Next.js 15 setup.

Immediately after scaffolding, initialize shadcn/ui inside `frontend/`:

```bash
cd frontend
npx shadcn@latest init --defaults
```

The `--defaults` flag uses the default style (New York), base color, and CSS variables — it overwrites `globals.css` with shadcn/ui's Tailwind v4 token setup (`@import "tailwindcss"`, `@theme inline`, CSS custom properties for light/dark). This is the correct order per research (Pitfall 3: shadcn init must run before custom CSS changes).

Add the shadcn/ui components that Phase 19 needs:

```bash
cd frontend
npx shadcn@latest add button sheet sonner
```

These provide: `Button` (universal), `Sheet` (mobile nav drawer), `Sonner` (toast notifications for API errors per locked decision).

Install remaining dependencies:

```bash
cd frontend
npm install @tanstack/react-query @tanstack/react-query-devtools next-themes
npm install -D openapi-typescript
```

Add the `generate-types` script to `frontend/package.json`:

```json
{
  "scripts": {
    "generate-types": "openapi-typescript http://localhost:8000/openapi.json -o src/types/api.generated.ts"
  }
}
```

Create `frontend/.env.local`:

```
NEXT_PUBLIC_API_URL=http://localhost:8000
```

Verify the dev server starts:

```bash
cd frontend && npm run dev
```

Visit http://localhost:3000 — should render the default Next.js page with Tailwind styling.
  </action>
  <verify>
    <automated>cd frontend && npm run build 2>&1 | tail -5</automated>
  </verify>
  <done>Next.js 15 app scaffolded at `frontend/` with TypeScript, Tailwind v4, shadcn/ui initialized (globals.css has @theme inline tokens), Button/Sheet/Sonner components in `frontend/src/components/ui/`, all npm dependencies installed (@tanstack/react-query, next-themes, openapi-typescript), `generate-types` script in package.json, `.env.local` with `NEXT_PUBLIC_API_URL`.</done>
</task>

<task type="auto">
  <name>Task 2: Create API fetch wrapper, generate types, and configure providers</name>
  <files>
    frontend/src/lib/api.ts
    frontend/src/types/api.generated.ts
    frontend/src/components/providers.tsx
    frontend/src/app/layout.tsx
  </files>
  <action>
**Part A — Thin API fetch wrapper (`frontend/src/lib/api.ts`):**

Create a minimal wrapper that adds base URL, headers, and handles JSON + error responses:

```typescript
const API_BASE = process.env.NEXT_PUBLIC_API_URL ?? 'http://localhost:8000'

export class ApiError extends Error {
  constructor(
    message: string,
    public status: number,
    public detail?: string
  ) {
    super(message)
    this.name = 'ApiError'
  }
}

export async function apiFetch<T>(
  path: string,
  options: RequestInit = {}
): Promise<T> {
  const res = await fetch(`${API_BASE}${path}`, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...options.headers,
    },
    credentials: 'include',
  })

  if (!res.ok) {
    const body = await res.json().catch(() => ({ detail: res.statusText }))
    throw new ApiError(
      body.detail ?? `API error ${res.status}`,
      res.status,
      body.detail
    )
  }

  // Handle 204 No Content
  if (res.status === 204) return undefined as T

  return res.json() as Promise<T>
}
```

The wrapper:
- Uses `NEXT_PUBLIC_API_URL` env var (auto-exposed to browser by Next.js)
- Sets `credentials: 'include'` for future cookie-based auth
- Throws a typed `ApiError` with status code for TanStack Query error handling
- Handles 204 No Content responses (common for DELETE endpoints)

**Part B — Generate API types:**

Ensure the FastAPI backend is running (`cd backend && poetry run task dev`), then:

```bash
cd frontend
mkdir -p src/types
npm run generate-types
```

This produces `frontend/src/types/api.generated.ts` with all TypeScript types matching the FastAPI OpenAPI schema. Add a comment header to the generated file:

```typescript
// AUTO-GENERATED by openapi-typescript from http://localhost:8000/openapi.json
// Regenerate: cd frontend && npm run generate-types (backend must be running)
// DO NOT EDIT manually — changes will be overwritten
```

Commit this file to git (per research recommendation — commit for simplicity, document the regenerate command).

**Part C — Providers component (`frontend/src/components/providers.tsx`):**

Create the client-side Providers component that wraps all pages:

```typescript
'use client'

import { QueryClient, QueryClientProvider } from '@tanstack/react-query'
import { ReactQueryDevtools } from '@tanstack/react-query-devtools'
import { ThemeProvider } from 'next-themes'
import { useState } from 'react'
import { Toaster } from '@/components/ui/sonner'

export function Providers({ children }: { children: React.ReactNode }) {
  const [queryClient] = useState(
    () =>
      new QueryClient({
        defaultOptions: {
          queries: {
            staleTime: 60 * 1000,
            retry: 1,
          },
        },
      })
  )

  return (
    <QueryClientProvider client={queryClient}>
      <ThemeProvider
        attribute="class"
        defaultTheme="system"
        enableSystem
        disableTransitionOnChange
      >
        {children}
        <Toaster richColors position="bottom-right" />
      </ThemeProvider>
      <ReactQueryDevtools initialIsOpen={false} />
    </QueryClientProvider>
  )
}
```

CRITICAL: QueryClient is created inside `useState(() => ...)` — NOT at module level. This prevents shared state across SSR requests (Pitfall 5 from research).

**Part D — Update root layout (`frontend/src/app/layout.tsx`):**

Replace the scaffolded layout.tsx with the Providers-wrapped version. Keep `suppressHydrationWarning` on `<html>` for next-themes (Pitfall from research):

```typescript
import type { Metadata } from 'next'
import { Providers } from '@/components/providers'
import './globals.css'

export const metadata: Metadata = {
  title: 'Bookstore',
  description: 'Discover and purchase books from our curated catalog',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="en" suppressHydrationWarning>
      <body className="min-h-screen bg-background font-sans antialiased">
        <Providers>
          {children}
        </Providers>
      </body>
    </html>
  )
}
```

Note: The layout shell (Header/Footer) will be added in Plan 19-03. This layout just wires up Providers.

Verify build succeeds with no TypeScript errors.
  </action>
  <verify>
    <automated>cd frontend && npx tsc --noEmit 2>&1 | tail -10 && npm run build 2>&1 | tail -5</automated>
  </verify>
  <done>`frontend/src/lib/api.ts` exports `apiFetch` and `ApiError`. `frontend/src/types/api.generated.ts` exists with types from FastAPI. `frontend/src/components/providers.tsx` exports `Providers` with QueryClientProvider + ThemeProvider + Toaster. `frontend/src/app/layout.tsx` wraps content in `<Providers>` with `suppressHydrationWarning` on `<html>`. TypeScript compiles with no errors. `npm run build` succeeds.</done>
</task>

</tasks>

<verification>
1. `cd frontend && npm run dev` — starts dev server on port 3000
2. `cd frontend && npm run build` — production build succeeds with zero errors
3. `cd frontend && npx tsc --noEmit` — TypeScript compilation clean
4. `cat frontend/src/types/api.generated.ts | head -5` — auto-generated types file exists
5. `grep -c "QueryClientProvider" frontend/src/components/providers.tsx` — provider is configured
6. `grep "suppressHydrationWarning" frontend/src/app/layout.tsx` — next-themes anti-flicker present
</verification>

<success_criteria>
- Next.js 15 dev server starts and renders styled content at localhost:3000
- shadcn/ui components (Button, Sheet, Sonner) available in `src/components/ui/`
- Dark mode works via next-themes with system preference detection
- TanStack Query provider wraps the entire app with devtools in development
- `api.generated.ts` contains TypeScript types from FastAPI's OpenAPI spec
- `apiFetch` wrapper handles errors with typed `ApiError` class
- TypeScript compiles with zero errors; production build succeeds
</success_criteria>

<output>
After completion, create `.planning/phases/19-monorepo-frontend-foundation/19-02-SUMMARY.md`
</output>
