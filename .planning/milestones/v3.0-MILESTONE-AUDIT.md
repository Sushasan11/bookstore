---
milestone: v3.0
audited: 2026-02-28T12:00:00Z
status: gaps_found
scores:
  requirements: 31/35
  phases: 5/7
  integration: 22/22
  flows: 7/7
gaps:
  requirements:
    - id: "WISH-01"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started — no plans, no code, no verification"
    - id: "WISH-02"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "WISH-03"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "WISH-04"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "PREB-01"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "PREB-02"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "PREB-03"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "PREB-04"
      status: "unsatisfied"
      phase: "Phase 24"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 24 not started"
    - id: "REVW-01"
      status: "unsatisfied"
      phase: "Phase 25"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 25 not started"
    - id: "REVW-02"
      status: "unsatisfied"
      phase: "Phase 25"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 25 not started"
    - id: "REVW-03"
      status: "unsatisfied"
      phase: "Phase 25"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 25 not started"
    - id: "REVW-04"
      status: "unsatisfied"
      phase: "Phase 25"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 25 not started"
    - id: "REVW-05"
      status: "unsatisfied"
      phase: "Phase 25"
      claimed_by_plans: []
      completed_by_plans: []
      verification_status: "missing"
      evidence: "Phase 25 not started"
  integration: []
  flows: []
tech_debt:
  - phase: 20-auth-integration
    items:
      - "AUTH-05: POST /auth/logout not called from frontend — refresh token remains valid server-side after logout"
      - "zod is an implicit transitive dependency of next-auth@beta — not in frontend/package.json"
      - "AUTH-08 description in REQUIREMENTS.md says '401 handling' but backend returns 403 — documentation inconsistency"
  - phase: 21-catalog-and-search
    items:
      - "RatingDisplay.tsx TODO: Phase 25 — link to reviews section"
      - "ActionButtons.tsx Wishlist button still disabled — will be activated in Phase 24"
      - "Extra fetchGenres() HTTP call on every book detail page render for breadcrumb genre name"
      - "api.generated.ts requires manual regeneration when backend schema changes"
  - phase: 22-cart-and-checkout
    items:
      - "fetchOrder lives in cart.ts instead of orders.ts — minor co-location smell across Phase 22/23 boundary"
---

# v3.0 Milestone Audit — Customer Storefront

**Audited:** 2026-02-28T12:00:00Z
**Status:** gaps_found
**Milestone Goal:** Build a Next.js 15 customer-facing storefront with full feature parity against all user-facing backend endpoints

## Scores

| Area | Score | Details |
|------|-------|---------|
| Requirements | 31/35 | 31 satisfied (Phases 19-23), 4 unsatisfied (Phase 24 not started), 5 unsatisfied (Phase 25 not started) |
| Phases | 5/7 | Phases 19, 20, 21, 22, 23 complete; Phases 24, 25 not started |
| Integration | 22/22 | All cross-phase wiring verified; previous apiFetch auth header gap resolved in Phase 22 |
| E2E Flows | 7/7 | All testable flows for completed phases work end-to-end |

## Completed Phase Summary

### Phase 19: Monorepo + Frontend Foundation — PASSED
- **Score:** 11/11 truths verified
- **Requirements:** FOUND-01 through FOUND-06 — all 6 SATISFIED
- **Human verification:** 3 items (CORS roundtrip, responsive layout, dark mode) — needs live browser
- **Gaps:** None

### Phase 20: Auth Integration — PASSED (human_needed)
- **Score:** 11/11 truths code-verified (8 need human confirmation)
- **Requirements:** AUTH-01 through AUTH-08 — all 8 SATISFIED
- **Human verification:** 8 items — all covered by Plan 20-03 human checkpoint (approved 2026-02-27)
- **Gaps:** None (security hardening items noted as tech debt)

### Phase 21: Catalog and Search — PASSED
- **Score:** 20/20 truths verified (13 plan must-haves + 7 additional)
- **Requirements:** CATL-01 through CATL-07 — all 7 SATISFIED
- **Human verification:** 3 items — covered by Plan 21-04 human sign-off (approved 2026-02-27)
- **Gaps:** None

### Phase 22: Cart and Checkout — PASSED
- **Score:** 20/20 truths verified
- **Requirements:** SHOP-01 through SHOP-06, SHOP-09, SHOP-10 — all 8 SATISFIED
- **Human verification:** 10 items — all covered by Plan 22-05 human sign-off (approved 2026-02-27)
- **Gaps:** None

### Phase 23: Orders and Account — PASSED
- **Score:** 4/4 truths verified
- **Requirements:** SHOP-07, SHOP-08 — both SATISFIED
- **Human verification:** 5 items — covered by Plan 23-02 human sign-off (approved 2026-02-28)
- **Gaps:** None

## 3-Source Requirements Cross-Reference

### Satisfied Requirements (31/35)

| REQ-ID | VERIFICATION.md | SUMMARY Frontmatter | REQUIREMENTS.md | Final Status |
|--------|----------------|---------------------|-----------------|-------------|
| FOUND-01 | SATISFIED | 19-01 | [x] | **satisfied** |
| FOUND-02 | SATISFIED | — | [x] | **satisfied** |
| FOUND-03 | SATISFIED | 19-01 | [x] | **satisfied** |
| FOUND-04 | SATISFIED | — | [x] | **satisfied** |
| FOUND-05 | SATISFIED | — | [x] | **satisfied** |
| FOUND-06 | SATISFIED | 19-03 | [x] | **satisfied** |
| AUTH-01 | SATISFIED | 20-01, 20-03 | [x] | **satisfied** |
| AUTH-02 | SATISFIED | 20-01, 20-03 | [x] | **satisfied** |
| AUTH-03 | SATISFIED | 20-01, 20-03 | [x] | **satisfied** |
| AUTH-04 | SATISFIED | 20-01, 20-03 | [x] | **satisfied** |
| AUTH-05 | SATISFIED | 20-02, 20-03 | [x] | **satisfied** |
| AUTH-06 | SATISFIED | 20-02, 20-03 | [x] | **satisfied** |
| AUTH-07 | SATISFIED | 20-01, 20-03 | [x] | **satisfied** |
| AUTH-08 | SATISFIED | 20-02, 20-03 | [x] | **satisfied** |
| CATL-01 | SATISFIED | 21-02, 21-04 | [x] | **satisfied** |
| CATL-02 | SATISFIED | 21-03, 21-04 | [x] | **satisfied** |
| CATL-03 | SATISFIED | 21-02, 21-04 | [x] | **satisfied** |
| CATL-04 | SATISFIED | 21-02, 21-04 | [x] | **satisfied** |
| CATL-05 | SATISFIED | 21-02, 21-04 | [x] | **satisfied** |
| CATL-06 | SATISFIED | 21-03, 21-04 | [x] | **satisfied** |
| CATL-07 | SATISFIED | 21-02, 21-03, 21-04 | [x] | **satisfied** |
| SHOP-01 | SATISFIED | 22-05 | [x] | **satisfied** |
| SHOP-02 | SATISFIED | 22-03, 22-05 | [x] | **satisfied** |
| SHOP-03 | SATISFIED | 22-03, 22-05 | [x] | **satisfied** |
| SHOP-04 | SATISFIED | 22-03, 22-05 | [x] | **satisfied** |
| SHOP-05 | SATISFIED | 22-05 | [x] | **satisfied** |
| SHOP-06 | SATISFIED | 22-05 | [x] | **satisfied** |
| SHOP-07 | SATISFIED | 23-01, 23-02 | [x] | **satisfied** |
| SHOP-08 | SATISFIED | 23-01, 23-02 | [x] | **satisfied** |
| SHOP-09 | SATISFIED | 22-05 | [x] | **satisfied** |
| SHOP-10 | SATISFIED | 22-03, 22-05 | [x] | **satisfied** |

### Unsatisfied Requirements (4/35) — Phase 24 Not Started

| REQ-ID | Description | Assigned Phase | Status |
|--------|-------------|---------------|--------|
| WISH-01 | Add to wishlist | Phase 24 | Not started |
| WISH-02 | Remove from wishlist | Phase 24 | Not started |
| WISH-03 | View wishlist page | Phase 24 | Not started |
| WISH-04 | Optimistic wishlist toggle | Phase 24 | Not started |
| PREB-01 | Pre-book button for out-of-stock | Phase 24 | Not started |
| PREB-02 | Pre-book an out-of-stock book | Phase 24 | Not started |
| PREB-03 | View active pre-bookings | Phase 24 | Not started |
| PREB-04 | Cancel pre-booking | Phase 24 | Not started |

### Unsatisfied Requirements (5/35) — Phase 25 Not Started

| REQ-ID | Description | Assigned Phase | Status |
|--------|-------------|---------------|--------|
| REVW-01 | Display reviews on book detail | Phase 25 | Not started |
| REVW-02 | Write review with star rating | Phase 25 | Not started |
| REVW-03 | Edit own review | Phase 25 | Not started |
| REVW-04 | Delete own review | Phase 25 | Not started |
| REVW-05 | Already-reviewed state | Phase 25 | Not started |

### Orphan Detection

No orphaned requirements. All 35 REQ-IDs in the REQUIREMENTS.md traceability table are assigned to phases, and the 31 completed ones all appear in at least one VERIFICATION.md and one SUMMARY.md.

## Cross-Phase Integration

### Wiring Summary

- **Connected exports:** 22 cross-phase connections verified
- **Orphaned exports:** 0
- **Missing connections:** 0

### Previously-Flagged Gaps — All Resolved

**1. apiFetch missing Authorization header injection — RESOLVED**
Previously flagged in the initial v3.0 audit. Phase 22 resolved this by passing the token explicitly at every authenticated call site in `cart.ts` and `orders.ts`. All six cart functions and `fetchOrders` inject `Authorization: Bearer ${accessToken}` directly. Not a global injection — per-call pattern is intentional.

**2. POST /auth/logout not called — ACKNOWLEDGED TECH DEBT**
`UserMenu.tsx` calls `signOut()` which clears the NextAuth cookie but does not revoke the backend refresh token. Impact: refresh token remains valid server-side until TTL expiry. Carried forward as tech debt — not a functional blocker.

### Key Integration Paths Verified

| From | To | Connection | Status |
|------|----|-----------|--------|
| Phase 19 `apiFetch` | Phase 21 `catalog.ts` | `import { apiFetch }` | WIRED |
| Phase 19 `apiFetch` | Phase 22 `cart.ts` | `import { apiFetch, ApiError }` | WIRED |
| Phase 19 `apiFetch` | Phase 23 `orders.ts` | `import { apiFetch }` | WIRED |
| Phase 19 `api.generated.ts` | Phase 21 `catalog.ts` | `import type { components }` | WIRED |
| Phase 19 `QueryClientProvider` | Phase 20 `providers.tsx` | 403 interceptor in QueryCache/MutationCache | WIRED |
| Phase 19 `Header` | Phase 20 `UserMenu` | `<UserMenu />` rendered in Header | WIRED |
| Phase 19 `Header` | Phase 22 `CartBadge` | `<CartBadge />` rendered in Header | WIRED |
| Phase 19 `Header/MobileNav` | Phase 23 `/account` | Account link added | WIRED |
| Phase 20 `SessionProvider` | Phase 22 `useCart` | `useSession()` for accessToken | WIRED |
| Phase 20 `proxy.ts` | Phase 22 `/cart` | `/cart` added to protectedPrefixes | WIRED |
| Phase 20 `auth()` | Phase 23 `/orders` | Server-side auth check | WIRED |
| Phase 21 `ActionButtons` | Phase 22 `useCart` | Activated with `addItem.mutate()` | WIRED |
| Phase 21 `BookCard` | Phase 22 `useCart` | Cart icon with `addItem.mutate()` | WIRED |
| Phase 22 `OrderDetail` | Phase 23 `/orders` | "View All Orders" back-link | WIRED |
| Phase 23 `OrderHistoryList` | Phase 22 `/orders/[id]` | `Link href=/orders/${id}` | WIRED |

## E2E Flow Verification

| # | Flow | Path | Status |
|---|------|------|--------|
| 1 | Anonymous catalog browse | `/catalog` → BookGrid → BookCard → `/books/[id]` | COMPLETE |
| 2 | Anonymous search with filters | Search → debounce → URL params → SSR re-render → results | COMPLETE |
| 3 | Email registration → browse | `/register` → signIn → redirect → Header auth state → `/catalog` | COMPLETE |
| 4 | Login → protected route redirect | `/account` → proxy redirect → `/login?callbackUrl` → signIn → redirect back | COMPLETE |
| 5 | Add to cart → checkout → confirmation | `/books/[id]` → Add to Cart → `/cart` → Checkout dialog → `/orders/[id]?confirmed=true` | COMPLETE |
| 6 | Cart management | `/cart` → update qty → remove item → optimistic updates → totals recalculated | COMPLETE |
| 7 | Order history browsing | `/orders` → order list → click row → `/orders/[id]` → "View All Orders" back | COMPLETE |

All 7 E2E flows pass with no breaks in the chain.

## Tech Debt

### Phase 20: Auth Integration (3 items)
- POST /auth/logout not called — refresh token persists after frontend logout
- `zod` is implicit transitive dependency of `next-auth@beta` — should be in `package.json`
- AUTH-08 REQUIREMENTS.md says "401 handling" but backend returns 403 — docs inconsistency

### Phase 21: Catalog and Search (4 items)
- `RatingDisplay.tsx` TODO: link to reviews section (deferred to Phase 25)
- `ActionButtons.tsx` Wishlist button still disabled (will be activated in Phase 24)
- Extra `fetchGenres()` HTTP call on every book detail page render for breadcrumb genre name
- `api.generated.ts` requires manual regeneration when backend schema changes

### Phase 22: Cart and Checkout (1 item)
- `fetchOrder` lives in `cart.ts` instead of `orders.ts` — minor co-location smell across Phase 22/23 boundary

**Total: 8 items across 3 phases — none are blockers**

---

*Audited: 2026-02-28T12:00:00Z*
*Auditor: Claude (gsd-audit-milestone)*
